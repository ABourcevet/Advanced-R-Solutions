[
["rcpp.html", "16 Rcpp 16.1 Getting started with C++ 16.2 Missing values 16.3 The STL", " 16 Rcpp 16.1 Getting started with C++ Q: With the basics of C++ in hand, it’s now a great time to practice by reading and writing some simple C++ functions. For each of the following functions, read the code and figure out what the corresponding base R function is. You might not understand every part of the code yet, but you should be able to figure out the basics of what the function does. double f1(NumericVector x) { int n = x.size(); double y = 0; for(int i = 0; i &lt; n; ++i) { y += x[i] / n; } return y; } NumericVector f2(NumericVector x) { int n = x.size(); NumericVector out(n); out[0] = x[0]; for(int i = 1; i &lt; n; ++i) { out[i] = out[i - 1] + x[i]; } return out; } bool f3(LogicalVector x) { int n = x.size(); for(int i = 0; i &lt; n; ++i) { if (x[i]) return true; } return false; } int f4(Function pred, List x) { int n = x.size(); for(int i = 0; i &lt; n; ++i) { LogicalVector res = pred(x[i]); if (res[0]) return i + 1; } return 0; } NumericVector f5(NumericVector x, NumericVector y) { int n = std::max(x.size(), y.size()); NumericVector x1 = rep_len(x, n); NumericVector y1 = rep_len(y, n); NumericVector out(n); for (int i = 0; i &lt; n; ++i) { out[i] = std::min(x1[i], y1[i]); } return out; } A: The R equivalents are: f1: mean() f2: cumsum() f3: any() f4: f5: pmin() Q: To practice your function writing skills, convert the following functions into C++. For now, assume the inputs have no missing values. all() cppFunction(&#39; bool allC(LogicalVector x) { int n = x.size(); for(int i = 0; i &lt; n; ++i) { if (!x[i]) return false; } return true; }&#39;) cumprod(), cummin(), cummax(). NumericVector cumprodC(NumericVector x) { int n = x.size(); NumericVector out(n); out[0] = x[0]; for(int i = 1; i &lt; n; ++i) { out[i] = out[i - 1] * x[i]; } return out; }&#39;) cppFunction(&#39; NumericVector cumminC(NumericVector x) { int n = x.size(); NumericVector out(n); out[0] = x[0]; for(int i = 1; i &lt; n; ++i) { out[i] = std::min(out[i - 1], x[i]); } return out; }&#39;) cppFunction(&#39; NumericVector cummaxC(NumericVector x) { int n = x.size(); NumericVector out(n); out[0] = x[0]; for(int i = 1; i &lt; n; ++i) { out[i] = std::max(out[i - 1], x[i]); } return out; }&#39;) diff(). Start by assuming lag 1, and then generalise for lag n. cppFunction(&#39; NumericVector diffC(NumericVector x){ int n = x.size(); NumericVector out(n - 1); for(int i = 1; i &lt; n; i++){ out[i - 1] = x[i] - x[i - 1]; } return out ; }&#39;) cppFunction(&#39; NumericVector difflagC(NumericVector x, int lag){ int n = x.size(); NumericVector out(n - lag); for(int i = lag; i &lt; n; i++){ out[i - lag] = x[i] - x[i - lag]; } return out; }&#39;) range. cppFunction(&#39;NumericVector rangeC(NumericVector x){ double omin, omax; int n = x.size(); NumericVector out(2); omin = x[0]; omax = x[0]; for(int i = 1; i &lt; n; i++){ omin = std::min(x[i], omin); omax = std::max(x[i], omax); } out[0] = omin; out[1] = omax; return out; }&#39;) var. Read about the approaches you can take on wikipedia. Whenever implementing a numerical algorithm, it’s always good to check what is already known about the problem. 16.2 Missing values Rewrite any of the functions from the first exercise to deal with missing values. If na.rm is true, ignore the missing values. If na.rm is false, return a missing value if the input contains any missing values. Some good functions to practice with are min(), max(), range(), mean(), and var(). Rewrite cumsum() and diff() so they can handle missing values. Note that these functions have slightly more complicated behaviour. 16.3 The STL To practice using the STL algorithms and data structures, implement the following using R functions in C++, using the hints provided: median.default() using partial_sort. %in% using unordered_set and the find() or count() methods. unique() using an unordered_set (challenge: do it in one line!). min() using std::min(), or max() using std::max(). which.min() using min_element, or which.max() using max_element. setdiff(), union(), and intersect() for integers using sorted ranges and set_union, set_intersection and set_difference. "]
]
