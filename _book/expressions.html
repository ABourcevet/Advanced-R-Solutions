<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Advanced-R-Solutions</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Solutions to the exercises in Hadley Wickhams book Advanced R.">
  <meta name="generator" content="bookdown 0.1.7 and GitBook 2.6.7">

  <meta property="og:title" content="Advanced-R-Solutions" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Solutions to the exercises in Hadley Wickhams book Advanced R." />
  <meta name="github-repo" content="Tazinho/Advanced-R-Solutions" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Advanced-R-Solutions" />
  
  <meta name="twitter:description" content="Solutions to the exercises in Hadley Wickhams book Advanced R." />
  

<meta name="author" content="Malte Grosser">

<meta name="date" content="2016-09-04">


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="non-standard-evaluation.html">
<link rel="next" href="domain-specific-languages.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Data structures</a></li>
<li class="chapter" data-level="3" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>3</b> Subsetting</a></li>
<li class="chapter" data-level="4" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>4</b> Functions</a></li>
<li class="chapter" data-level="5" data-path="oo-field-guide.html"><a href="oo-field-guide.html"><i class="fa fa-check"></i><b>5</b> OO field guide</a></li>
<li class="chapter" data-level="6" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>6</b> Environments</a></li>
<li class="chapter" data-level="7" data-path="exceptions-and-debugging.html"><a href="exceptions-and-debugging.html"><i class="fa fa-check"></i><b>7</b> Exceptions and debugging</a></li>
<li class="chapter" data-level="8" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>8</b> Functional programming</a></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a></li>
<li class="chapter" data-level="10" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>10</b> Function operators</a></li>
<li class="chapter" data-level="11" data-path="non-standard-evaluation.html"><a href="non-standard-evaluation.html"><i class="fa fa-check"></i><b>11</b> Non standard evaluation</a></li>
<li class="chapter" data-level="12" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>12</b> Expressions</a><ul>
<li class="chapter" data-level="12.1" data-path="expressions.html"><a href="expressions.html#structure-of-expressions"><i class="fa fa-check"></i><b>12.1</b> Structure of expressions</a></li>
<li class="chapter" data-level="12.2" data-path="expressions.html"><a href="expressions.html#names"><i class="fa fa-check"></i><b>12.2</b> Names</a></li>
<li class="chapter" data-level="12.3" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>12.3</b> Calls</a></li>
<li class="chapter" data-level="12.4" data-path="expressions.html"><a href="expressions.html#capturing-the-current-call"><i class="fa fa-check"></i><b>12.4</b> Capturing the current call</a></li>
<li class="chapter" data-level="12.5" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>12.5</b> Pairlists</a></li>
<li class="chapter" data-level="12.6" data-path="expressions.html"><a href="expressions.html#parsing-and-deparsing"><i class="fa fa-check"></i><b>12.6</b> Parsing and deparsing</a></li>
<li class="chapter" data-level="12.7" data-path="expressions.html"><a href="expressions.html#walking-the-ast-with-recursive-functions"><i class="fa fa-check"></i><b>12.7</b> Walking the AST with recursive functions</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="domain-specific-languages.html"><a href="domain-specific-languages.html"><i class="fa fa-check"></i><b>13</b> Domain specific languages</a></li>
<li class="chapter" data-level="14" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>14</b> Performance</a></li>
<li class="chapter" data-level="15" data-path="profiling.html"><a href="profiling.html"><i class="fa fa-check"></i><b>15</b> Profiling</a></li>
<li class="chapter" data-level="16" data-path="memory.html"><a href="memory.html"><i class="fa fa-check"></i><b>16</b> Memory</a></li>
<li class="chapter" data-level="17" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>17</b> Rcpp</a></li>
<li class="chapter" data-level="18" data-path="rs-c-interface.html"><a href="rs-c-interface.html"><i class="fa fa-check"></i><b>18</b> R’s C interface</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced-R-Solutions</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="expressions" class="section level1">
<h1><span class="header-section-number">12</span> Expressions</h1>
<div id="structure-of-expressions" class="section level2">
<h2><span class="header-section-number">12.1</span> Structure of expressions</h2>
<ol style="list-style-type: decimal">
<li><p>There’s no existing base function that checks if an element is a valid component of an expression (i.e., it’s a constant, name, call, or pairlist). Implement one by guessing the names of the “is” functions for calls, names, and pairlists.</p>
<p>pryr::ast() uses non-standard evaluation. What’s its escape hatch to standard evaluation?</p></li>
<li><p>What does the call tree of an if statement with multiple else conditions look like?</p></li>
<li><p>Compare ast(x + y %+% z) to ast(x ^ y %+% z). What do they tell you about the precedence of custom infix functions?</p></li>
<li><p>Why can’t an expression contain an atomic vector of length greater than one? Which one of the six types of atomic vector can’t appear in an expression? Why?</p></li>
</ol>
</div>
<div id="names" class="section level2">
<h2><span class="header-section-number">12.2</span> Names</h2>
<ol style="list-style-type: decimal">
<li><p>You can use formals() to both get and set the arguments of a function. Use formals() to modify the following function so that the default value of x is missing and y is 10.</p>
<p>g &lt;- function(x = 20, y) { x + y }</p></li>
<li><p>Write an equivalent to get() using as.name() and eval(). Write an equivalent to assign() using as.name(), substitute(), and eval(). (Don’t worry about the multiple ways of choosing an environment; assume that the user supplies it explicitly.)</p></li>
</ol>
</div>
<div id="calls" class="section level2">
<h2><span class="header-section-number">12.3</span> Calls</h2>
<ol style="list-style-type: decimal">
<li><p>The following two calls look the same, but are actually different:</p>
<p>(a &lt;- call(“mean”, 1:10)) #&gt; mean(1:10) (b &lt;- call(“mean”, quote(1:10))) #&gt; mean(1:10) identical(a, b) #&gt; [1] FALSE</p>
<p>What’s the difference? Which one should you prefer?</p></li>
<li><p>Implement a pure R version of do.call().</p></li>
<li><p>Concatenating a call and an expression with c() creates a list. Implement concat() so that the following code works to combine a call and an additional argument.</p>
<p>concat(quote(f), a = 1, b = quote(mean(a))) #&gt; f(a = 1, b = mean(a))</p></li>
<li><p>Since list()s don’t belong in expressions, we could create a more convenient call constructor that automatically combines lists into the arguments. Implement make_call() so that the following code works.</p>
<p>make_call(quote(mean), list(quote(x), na.rm = TRUE)) #&gt; mean(x, na.rm = TRUE) make_call(quote(mean), quote(x), na.rm = TRUE) #&gt; mean(x, na.rm = TRUE)</p></li>
<li><p>How does mode&lt;- work? How does it use call()?</p></li>
<li><p>Read the source for pryr::standardise_call(). How does it work? Why is is.primitive() needed?</p></li>
<li><p>standardise_call() doesn’t work so well for the following calls. Why?</p>
<p>standardise_call(quote(mean(1:10, na.rm = TRUE))) #&gt; mean(x = 1:10, na.rm = TRUE) standardise_call(quote(mean(n = T, 1:10))) #&gt; mean(x = 1:10, n = T) standardise_call(quote(mean(x = 1:10, , TRUE))) #&gt; mean(x = 1:10, , TRUE)</p></li>
<li><p>Read the documentation for pryr::modify_call(). How do you think it works? Read the source code.</p></li>
<li><p>Use ast() and experimentation to figure out the three arguments in an if() call. Which components are required? What are the arguments to the for() and while() calls?</p></li>
</ol>
</div>
<div id="capturing-the-current-call" class="section level2">
<h2><span class="header-section-number">12.4</span> Capturing the current call</h2>
<ol style="list-style-type: decimal">
<li><p>Compare and contrast update_model() with update.default().</p></li>
<li><p>Why doesn’t write.csv(mtcars, “mtcars.csv”, row = FALSE) work? What property of argument matching has the original author forgotten?</p></li>
<li><p>Rewrite update.formula() to use R code instead of C code.</p></li>
<li><p>Sometimes it’s necessary to uncover the function that called the function that called the current function (i.e., the grandparent, not the parent). How can you use sys.call() or match.call() to find this function?</p></li>
</ol>
</div>
<div id="pairlists" class="section level2">
<h2><span class="header-section-number">12.5</span> Pairlists</h2>
<ol style="list-style-type: decimal">
<li><p>How are alist(a) and alist(a = ) different? Think about both the input and the output.</p></li>
<li><p>Read the documentation and source code for pryr::partial(). What does it do? How does it work? Read the documentation and source code for pryr::unenclose(). What does it do and how does it work?</p></li>
<li><p>The actual implementation of curve() looks more like</p>
<p>curve3 &lt;- function(expr, xlim = c(0, 1), n = 100, env = parent.frame()) { env2 &lt;- new.env(parent = env) env2$x &lt;- seq(xlim[1], xlim[2], length = n)</p>
<p>y &lt;- eval(substitute(expr), env2) plot(env2$x, y, type = “l”, ylab = deparse(substitute(expr))) }</p></li>
</ol>
<p>How does this approach differ from curve2() defined above?</p>
</div>
<div id="parsing-and-deparsing" class="section level2">
<h2><span class="header-section-number">12.6</span> Parsing and deparsing</h2>
<ol style="list-style-type: decimal">
<li><p>What are the differences between quote() and expression()?</p></li>
<li><p>Read the help for deparse() and construct a call that deparse() and parse() do not operate symmetrically on.</p></li>
<li><p>Compare and contrast source() and sys.source().</p></li>
<li><p>Modify simple_source() so it returns the result of every expression, not just the last one.</p></li>
<li><p>The code generated by simple_source() lacks source references. Read the source code for sys.source() and the help for srcfilecopy(), then modify simple_source() to preserve source references. You can test your code by sourcing a function that contains a comment. If successful, when you look at the function, you’ll see the comment and not just the source code.</p></li>
</ol>
</div>
<div id="walking-the-ast-with-recursive-functions" class="section level2">
<h2><span class="header-section-number">12.7</span> Walking the AST with recursive functions</h2>
<ol style="list-style-type: decimal">
<li><p>Why does logical_abbr() use a for loop instead of a functional like lapply()?</p></li>
<li><p>logical_abbr() works when given quoted objects, but doesn’t work when given an existing function, as in the example below. Why not? How could you modify logical_abbr() to work with functions? Think about what components make up a function.</p>
<p>f &lt;- function(x = TRUE) { g(x + T) } logical_abbr(f)</p></li>
<li><p>Write a function called ast_type() that returns either “constant”, “name”, “call”, or “pairlist”. Rewrite logical_abbr(), find_assign(), and bquote2() to use this function with switch() instead of nested if statements.</p></li>
<li><p>Write a function that extracts all calls to a function. Compare your function to pryr::fun_calls().</p></li>
<li><p>Write a wrapper around bquote2() that does non-standard evaluation so that you don’t need to explicitly quote() the input.</p></li>
<li><p>Compare bquote2() to bquote(). There is a subtle bug in bquote(): it won’t replace calls to functions with no arguments. Why?</p>
<p>bquote(.(x)(), list(x = quote(f))) #&gt; .(x)() bquote(.(x)(1), list(x = quote(f))) #&gt; f(1)</p></li>
<li><p>Improve the base recurse_call() template to also work with lists of functions and expressions (e.g., as from parse(path_to_file)).</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="non-standard-evaluation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="domain-specific-languages.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
